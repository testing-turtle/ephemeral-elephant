# Test workflow to generate telemetry events with varying durations
# This workflow is designed to test the telemetry capture system
name: Test Telemetry - Duration

on:
  workflow_dispatch:
    inputs:
      duration_seconds:
        description: "Duration to sleep (in seconds)"
        required: false
        default: "10"

jobs:
  quick-job:
    name: Quick Job (~5s)
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - name: Quick step
        run: |
          echo "Starting quick job..."
          sleep 2
          echo "Quick job completed!"

  medium-job:
    name: Medium Job (~30s)
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - name: Setup step
        run: |
          echo "Setting up..."
          sleep 5

      - name: Processing step
        run: |
          echo "Processing..."
          sleep 15

      - name: Cleanup step
        run: |
          echo "Cleaning up..."
          sleep 5
          echo "Medium job completed!"

  long-job:
    name: Long Job (~60s)
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - name: Initialize
        run: |
          echo "Initializing long job..."
          sleep 10

      - name: Build phase
        run: |
          echo "Building..."
          sleep 20

      - name: Test phase
        run: |
          echo "Testing..."
          sleep 20

      - name: Deploy phase
        run: |
          echo "Deploying..."
          sleep 5
          echo "Long job completed!"

  custom-duration:
    name: Custom Duration Job
    runs-on: ubuntu-latest
    if: github.event_name == 'workflow_dispatch'
    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - name: Run for custom duration
        run: |
          echo "Running for ${{ github.event.inputs.duration_seconds }} seconds..."
          sleep ${{ github.event.inputs.duration_seconds }}
          echo "Custom duration job completed!"

  parallel-jobs:
    name: Parallel Job ${{ matrix.index }}
    runs-on: ubuntu-latest
    strategy:
      matrix:
        index: [1, 2, 3]
    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - name: Run parallel task
        run: |
          echo "Running parallel job ${{ matrix.index }}..."
          sleep $((5 * ${{ matrix.index }}))
          echo "Parallel job ${{ matrix.index }} completed!"

  skipped-job:
    name: Skipped Job
    runs-on: ubuntu-latest
    if: false
    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - name: This will never run
        run: |
          echo "This step will never execute"

  summary:
    name: Summary
    runs-on: ubuntu-latest
    needs: [quick-job, medium-job, long-job, parallel-jobs]
    steps:
      - name: checkout
        uses: actions/checkout@v6
        with:
          sparse-checkout: |
            .github/actions
      - name: Telemetry summary
        uses: ./.github/actions/telemetry-summary
        with:
          workbook-url: ${{ vars.TELEMETRY_WORKBOOK_VIEW_URL }}

      - name: Generate summary
        run: |
          echo "## Telemetry Test Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "All duration test jobs completed successfully!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Job | Expected Duration |" >> $GITHUB_STEP_SUMMARY
          echo "|-----|-------------------|" >> $GITHUB_STEP_SUMMARY
          echo "| Quick Job | ~5s |" >> $GITHUB_STEP_SUMMARY
          echo "| Medium Job | ~30s |" >> $GITHUB_STEP_SUMMARY
          echo "| Long Job | ~60s |" >> $GITHUB_STEP_SUMMARY
          echo "| Parallel Jobs | 5-15s each |" >> $GITHUB_STEP_SUMMARY
          echo "| Skipped Job | N/A (always skipped) |" >> $GITHUB_STEP_SUMMARY
